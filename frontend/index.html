<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Shortener</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --accent: #22d3ee;
      --muted: #9ca3af;
      --text: #e5e7eb;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at 20% 20%, #1e293b, #0f172a 45%),
                  radial-gradient(circle at 80% 0%, #0ea5e9, #0f172a 35%),
                  #0f172a;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      color: var(--text);
      padding: 1.5rem;
    }
    .card {
      width: min(520px, 100%);
      background: linear-gradient(145deg, #0b1220, #0f172a 60%, #0b1220);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 25px 70px rgba(0,0,0,0.35), 0 0 0 1px rgba(255,255,255,0.03);
    }
    .title {
      margin: 0 0 0.75rem;
      font-size: 1.6rem;
      letter-spacing: -0.01em;
    }
    .muted { color: var(--muted); margin: 0 0 1.5rem; }
    form { display: grid; gap: 0.75rem; }
    label { font-size: 0.9rem; color: var(--muted); }
    input {
      width: 100%;
      padding: 0.9rem 1rem;
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      background: rgba(255,255,255,0.02);
      color: var(--text);
      font-size: 1rem;
    }
    input:focus {
      outline: 2px solid rgba(34, 211, 238, 0.4);
      border-color: transparent;
      box-shadow: 0 0 0 4px rgba(34, 211, 238, 0.08);
    }
    .row { display: grid; gap: 0.75rem; }
    .actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      align-items: center;
    }
    button {
      padding: 0.9rem 1.2rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      color: #0f172a;
      background: linear-gradient(120deg, #22d3ee, #0ea5e9);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    button:active { transform: translateY(1px); }
    button:focus-visible {
      outline: 2px solid #22d3ee;
      outline-offset: 3px;
    }
    .result {
      margin-top: 1rem;
      padding: 0.9rem 1rem;
      border-radius: 12px;
      background: rgba(34, 211, 238, 0.08);
      border: 1px solid rgba(34, 211, 238, 0.25);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    .result a { color: #67e8f9; word-break: break-all; }
    .pill {
      font-size: 0.85rem;
      padding: 0.35rem 0.65rem;
      background: rgba(255,255,255,0.06);
      border-radius: 999px;
      display: inline-block;
      color: var(--muted);
    }
    .error {
      color: #fca5a5;
      margin-top: 0.5rem;
      font-size: 0.95rem;
    }
    .status { color: var(--muted); font-size: 0.95rem; }
    @media (max-width: 540px) {
      .card { padding: 1.2rem; }
      .actions { flex-direction: column; align-items: stretch; }
      button { width: 100%; text-align: center; }
    }
  </style>
</head>
<body>
  <main class="card">
    <h1 class="title">Shorten a link</h1>
    <p class="muted">Drop in a long URL and weâ€™ll give you a short one you can share.</p>
    <form id="shorten-form">
      <div class="row">
        <label for="long-url">Long URL</label>
        <input id="long-url" name="url" type="url" placeholder="https://example.com/very/long/link" required>
      </div>
      <div class="actions">
        <button type="submit">Shorten</button>
        <span class="status" id="status"></span>
      </div>
    </form>
    <div id="result" class="result" style="display:none">
      <span class="pill">Short link</span>
      <a id="short-link" href="#" target="_blank" rel="noopener noreferrer"></a>
      <button id="copy-btn" type="button" style="align-self:flex-start">Copy</button>
    </div>
    <div id="error" class="error" style="display:none"></div>
  </main>

  <script>
    (function() {
      const form = document.getElementById('shorten-form');
      const urlInput = document.getElementById('long-url');
      const statusEl = document.getElementById('status');
      const resultBox = document.getElementById('result');
      const linkEl = document.getElementById('short-link');
      const copyBtn = document.getElementById('copy-btn');
      const errorEl = document.getElementById('error');

      form.noValidate = true;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        errorEl.style.display = 'none';
        resultBox.style.display = 'none';
        const apiBase = 'https://hwrk.help';
        const longUrl = urlInput.value.trim();

        if (!longUrl) {
          showError('Please enter a URL to shorten.');
          return;
        }

        const validatedUrl = validateHttpsUrl(longUrl);
        if (!validatedUrl) {
          showError('Please enter a valid https URL.');
          return;
        }

        urlInput.value = validatedUrl;
        statusEl.textContent = 'Working...';
        try {
          const res = await fetch(`${apiBase}/url`, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: validatedUrl,
          });

          if (!res.ok) {
            const text = await res.text();
            throw new Error(text || `Request failed (${res.status})`);
          }

          const data = await res.json();
          const shortUrl = `${apiBase}/${data.code}`;
          linkEl.href = shortUrl;
          linkEl.textContent = shortUrl;
          resultBox.style.display = 'flex';
          statusEl.textContent = 'Done';
        } catch (err) {
          showError(err.message || err || 'Something went wrong.');
          statusEl.textContent = '';
        }
      });

      copyBtn.addEventListener('click', async () => {
        const text = linkEl.textContent;
        if (!text) return;
        try {
          await navigator.clipboard.writeText(text);
          statusEl.textContent = 'Copied!';
          setTimeout(() => statusEl.textContent = '', 1200);
        } catch (_) {
          showError('Could not copy to clipboard.');
        }
      });

      function showError(message) {
        errorEl.textContent = message;
        errorEl.style.display = 'block';
      }

      function validateHttpsUrl(input) {
        if (!input) return null;
        const trimmed = input.trim();
        const normalized = /^https?:\/\//i.test(trimmed)
          ? trimmed.replace(/^http:\/\//i, 'https://')
          : `https://${trimmed}`;
        try {
          const parsed = new URL(normalized);
          if (parsed.protocol !== 'https:' || !parsed.host) return null;
          return normalized;
        } catch (_) {
          return null;
        }
      }
    })();
  </script>
</body>
</html>
